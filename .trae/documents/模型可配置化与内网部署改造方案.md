## 目标范围
- **模型可配置展示**：后端/配置里启用哪些模型，Web 页面只展示哪些模型（按 market/运行配置维度）。
- **内网部署**：给出入站/出站网络开通清单、端口与域名、代理/证书/密钥管理等注意事项。
- **规格文档**：在 `spec/` 目录输出改造说明、部署说明、任务规划。

## 现状梳理（只读调研）
- 后端模型启用入口：`configs/*.json` 的 `models[].enabled`；运行入口 `main.py`。
- 前端展示入口：`docs/config.yaml`（markets/agents）与 `docs/assets/js/*` 读取逻辑。
- 外部依赖与端口：
  - UI 静态服务端口（默认 8888）
  - MCP 服务端口（默认 8000/8001/8002/8003/8005）
  - 外部 API：LLM 网关/代理（由 `OPENAI_API_BASE` 决定）、AlphaVantage、Jina、Tushare/efinance 等。

## 设计方案
### 1) 单一事实来源（Single Source of Truth）
- 以 **后端配置**（`configs/*.json`）作为“启用模型”的唯一来源。
- 前端不再维护硬编码模型列表，改为从配置生成/加载。
？
### 2) 配置同步机制（二选一，推荐 A）
- **方案 A（推荐）生成前端配置**：提供脚本读取 `configs/*.json`，输出 `docs/config.generated.yaml`，UI 优先加载该文件，不存在则回退 `docs/config.yaml`。
  - 优点：不改前端页面逻辑即可动态控制展示；发布时只交付生成后的 YAML。
- **方案 B 运行时探测**：前端扫描 `data/agent_data/**` 自动发现可用模型。
  - 风险：与“只配置哪些就展示哪些”的诉求不完全一致（可能扫出历史数据）；且控制粒度差。

### 3) 显示信息策略
- `config.generated.yaml` 里显式写入：`display_name/icon/color/enabled`。
- 若缺省，前端提供按模型前缀推断的兜底（google/openai/anthropic/qwen/deepseek/...）。

### 4) 内网部署策略
- 推荐：**所有外呼统一走企业代理/网关**（最小化域名放行面），并在代理侧做 allowlist、审计、限流。
- MCP 与 UI 仅对内网必要网段开放。

## 代码改造任务分解
### A. 模型可配置化（前端）
- 新增脚本：从 `configs/*.json` 生成 `docs/config.generated.yaml`。
- 修改前端 config loader：优先加载 `config.generated.yaml`，失败回退 `config.yaml`。
- 清理/弱化前端硬编码的模型名->icon/color 映射（改为配置驱动 + 兜底推断）。
- 启动 UI 脚本：启动前自动执行一次配置同步（可选）。

### B. 内网部署文档与配置
- 输出网络开通清单：
  - 入站：UI 端口、MCP 端口（以及是否仅 localhost）。
  - 出站：LLM 网关/代理、AlphaVantage、Jina、Tushare/efinance（按启用功能）。
- 输出其他考虑：密钥管理、证书链、HTTP(S) 代理、审计、限流、日志脱敏、数据保留。

### C. spec 目录输出
- `spec/model_configurable_plan.md`：改造原理、文件结构、使用方法、验收点。
- `spec/intranet_deployment.md`：网络开通清单、部署形态、风险项。
- `spec/task_plan.md`：里程碑、拆分、验收标准。

## 验收与验证
- 配置只启用 Google 模型时：UI 仅出现 Google 模型相关条目。
- 配置启用多家模型时：UI 展示对应模型，且仅加载存在数据的 agents。
- YAML 生成与解析成功；本地静态 UI 正常启动。
- MCP 端口与 Agent 默认端口一致性检查通过。

## 回滚策略
- 保留 `docs/config.yaml` 作为回退；如果生成配置失败或缺失，UI 自动回退到原配置。

如果你确认该方案，我将按上述任务依次落地代码改动与 spec 输出，并跑一轮本地验证命令。